From aba35e0cec1142e43c198a9ff1d500278b570dd8 Mon Sep 17 00:00:00 2001
From: axionl <i@axionl.me>
Date: Sun, 20 Oct 2019 22:11:20 +0800
Subject: [PATCH 2/2] modify the config path for qv2ray

---
 src/Qv2rayBase.h | 2 +-
 src/QvUtils.cpp  | 7 +++++++
 src/QvUtils.h    | 1 +
 src/main.cpp     | 6 +++---
 4 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/src/Qv2rayBase.h b/src/Qv2rayBase.h
index b453fe4..2a0e132 100644
--- a/src/Qv2rayBase.h
+++ b/src/Qv2rayBase.h
@@ -21,7 +21,7 @@
 #define QV2RAY_V2RAY_CORE_PATH (QV2RAY_V2RAY_CORE_DIR_PATH + "v2ray.exe")
 #else
 // macOS and Linux....
-#define QV2RAY_V2RAY_CORE_PATH (QV2RAY_V2RAY_CORE_DIR_PATH + "v2ray")
+#define QV2RAY_V2RAY_CORE_PATH (Qv2ray::Utils::GetVCorePath())
 #endif
 
 #define QV2RAY_CONNECTION_FILE_EXTENSION ".qv2ray.json"
diff --git a/src/QvUtils.cpp b/src/QvUtils.cpp
index 1478281..db23201 100644
--- a/src/QvUtils.cpp
+++ b/src/QvUtils.cpp
@@ -7,6 +7,7 @@ namespace Qv2ray
     {
         static Qv2rayConfig GlobalConfig;
         static QString ConfigDirPath;
+        static QString VCorePath;
         void SetGlobalConfig(Qv2rayConfig conf)
         {
             GlobalConfig = conf;
@@ -15,6 +16,12 @@ namespace Qv2ray
             StringToFile(&str, &config);
         }
 
+        QString GetVCorePath()
+        {
+            VCorePath = "/usr/bin/v2ray";
+            return VCorePath;
+        }
+
         Qv2rayConfig GetGlobalConfig()
         {
             return GlobalConfig;
diff --git a/src/QvUtils.h b/src/QvUtils.h
index 20626c0..eb37158 100644
--- a/src/QvUtils.h
+++ b/src/QvUtils.h
@@ -20,6 +20,7 @@ namespace Qv2ray
 
         void SetConfigDirPath(const QString *path);
         QString GetConfigDirPath();
+        QString GetVCorePath();
 
         void SetGlobalConfig(Qv2rayConfig conf);
         Qv2rayConfig GetGlobalConfig();
diff --git a/src/main.cpp b/src/main.cpp
index 068d912..9867cf8 100644
--- a/src/main.cpp
+++ b/src/main.cpp
@@ -38,7 +38,7 @@ bool initQv()
         //
         // These below genenrated very basic global config.
         Qv2rayBasicInboundsConfig inboundSetting = Qv2rayBasicInboundsConfig("127.0.0.1", 1080, 8000);
-        Qv2rayConfig conf = Qv2rayConfig("zh-CN", QV2RAY_V2RAY_CORE_DIR_PATH.toStdString(), 4, inboundSetting);
+        Qv2rayConfig conf = Qv2rayConfig("zh-CN", "/etc/v2ray/", 4, inboundSetting);
         //
         // Save initial config.
         SetGlobalConfig(conf);
@@ -89,9 +89,9 @@ int main(int argc, char *argv[])
     //
 #ifdef QT_DEBUG
     LOG("DEBUG", "============================== This is a debug build, many features are not stable enough. ==============================")
-    QString configPath = QDir::homePath() + "/.qv2ray_debug";
+    QString configPath = QDir::homePath() + "/.config/qv2ray_debug";
 #else
-    QString configPath = QDir::homePath() + "/.qv2ray";
+    QString configPath = QDir::homePath() + "/.config/qv2ray";
 #endif
     SetConfigDirPath(&configPath);
     auto langs = getFileList(QDir(":/translations"));
-- 
2.23.0

